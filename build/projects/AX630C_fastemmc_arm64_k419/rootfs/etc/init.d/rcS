#!/bin/sh
export PATH="/bin:/sbin:/usr/bin:/usr/sbin:/opt/bin:/opt/usr/bin:/opt/scripts:/soc/bin:/soc/scripts:/usr/local/bin"
export LD_LIBRARY_PATH="/usr/local/lib:/usr/lib:/opt/lib:/opt/usr/lib:/soc/lib"
if [ -e /etc/init.d/S99checkboot ]; then
	chmod 755 /etc/init.d/S99checkboot
	chmod 755 /etc/init.d/checkslot
fi
echo /sbin/mdev > /proc/sys/kernel/hotplug
mdev -s
rcS_start=$(devmem 0x4820000)
devmem 0x92c 32 $rcS_start
#mknod /dev/null c 1 3

mkdir -p /opt/data/AXSyslog
/etc/init.d/axsyslogd start
/etc/init.d/axklogd start &

# coredump settings
ulimit -c unlimited
echo /customer/data/core-%e-%p-%t > /proc/sys/kernel/core_pattern

#wait /dev/mmcblk0px
while [ ! -e /dev/mmcblk0p15 ] ||
	[ ! -e /dev/mmcblk0p16 ] || [ ! -e /dev/mmcblk0p17 ]; do
		:
done

mount -a
if [ -e "/customer/qsres/run.sh" ]; then
	/customer/qsres/run.sh
else
	echo "not found /customer/qsres/run.sh"
fi

mount -t pstore pstore /sys/fs/pstore
sed -i 's/\(AX_SYSLOG_path =\)\(.*\)/\1 \/customer\/data/' /etc/ax_syslog.conf
mkdir -p /customer/data/AXSyslog/kernel
mkdir -p /customer/data/AXSyslog/syslog_boot
/etc/init.d/axsyslogd restart
/etc/init.d/axklogd restart &
cp -rf /opt/data/AXSyslog/syslog/* /customer/data/AXSyslog/syslog_boot

hwclock -s &
hwclock_end=$(devmem 0x4820000)
devmem 0x930 32 $hwclock_end

#chmod 755 /soc/scripts/auto_load_all_drv.sh
#/soc/scripts/auto_load_all_drv.sh
#ko_load=$(devmem 0x4820000)
#devmem 0x934 32 $ko_load
#
/soc/scripts/net_load.sh -i

for i in /etc/init.d/S??* ;do

     # Ignore dangling symlinks (if any).
     [ ! -f "$i" ] && continue

     case "$i" in
	*.sh)
	    # Source shell script for speed.
	    (
		trap - INT QUIT TSTP
		set start
		. $i
	    )
	    ;;
	*)
	    # No sh extension, so fork subprocess.
	    $i start
	    ;;
    esac
done

#S_load=$(devmem 0x4820000)
#devmem 0x938 32 $S_load
#
#chmod 755 /soc/scripts/npu_set_bw_limiter.sh
#/soc/scripts/npu_set_bw_limiter.sh start
#
#/soc/scripts/usb-acm.sh start
#other_load=$(devmem 0x4820000)
#devmem 0x93C 32 $other_load

